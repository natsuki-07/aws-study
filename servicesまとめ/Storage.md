# Storageサービス  
一般的に3つに分類できる  
- ブロックストレージ・・・記憶領域を物理的なディスクにブロック単位で管理するストレージ。  
- ファイルストレージ・・・ブロックストレージ賞に際るシステムを構成してデータをファイル単位で管理するストレージ  
- オブジェクトストレージ・・・ファイルに任意のメタデータを追加してオブジェクトとして管理するストレージ。  



## Amazon Elastic Block Store(EBS)  
EC2と共に使用するために設計された、スループットとトランザクションの両方が集中するどんな規模のワークロードにも対応できる使いやすい高性能なブロックストレージサービス。  
6種類のボリュームタイプから選べるので最適な料金とパフォーマンスのバランスを維持できる。  
EBSボリュームはAZ内でレプリケーションされることで障害を防ぐように設計されていて99.999%の可用性を達成する。  

ミッションクリティカルなシステム向けに設計されているのでEBSボリュームはAZ内でレプリケーションし、ペタバイト規模のデータに簡単にスケールできる。EC2インスタンスが停止・削除されてもデータを使用できるが、デフォルトの設定ではEC2インスタンスが削除されるとEBSも削除される　  

EBSスナップショットは増分バックアップでありS3に自動的に保存される。自分で作成したスナップショットや共有したスナップショットなど、アクセス可能なスナップショットを別のリージョンまたはアカウントにコピーできる。AWSマーケットプレイスで利用可能なAmazonマシンイメージ(AMI)の作成に使用されるスナップショットをコピーすることもできる。これを使用して、他のリージョンまたはアカウントで新しいEC2インスタンスを起動できる。  
  

### ボリュームタイプ
#### 汎用SSD　　
もっとも一般的なSSDをベースとしたボリュームタイプ。性能の指標としてIOPSを用い、3IOPS/GBから最大16,000IOPS/ボリュームまで容量に応じたベースライン性能がある。  

#### プロビジョンドIOPS SSD　　
プロビジョンドIOPSはEBSで最も高性能なSSDをベースとしたボリュームタイプ。IOPS負荷の高いユースケースと、高いスループットが必要なユースケースの両方に適したストレージタイプ。  

#### スループット最適化HDD  
スループット最適化HDDはHDDをベースとしたスループット重視のボリュームタイプ。ログデータに対する処理やバッチ処理のインプット用ファイルなど、大容量ファイルを高速に読み取るようなユースケースに適している。  

#### Cold HDD  
４つのストレージタイプの中でストレージとしての性能はそれほど高くないが、最も低コスト。利用頻度があまりなくアクセス時の性能も求められないデータをシーケンシャルにアクセスするようなユースケースやアーカイブ領域の用途に適している。  

### ベースライン性能とバースト性能  
プロビジョンドIOPS以外はベースライン性能があるが、それとは異なり、処理量の一時的な増加に対応可能なバースト性能という指標もある。  

### 拡張と変更  
容量についてはすべてのタイプのEBSは1ボリュームあたりの最大容量が16TB。ディスク容量が不足したら必要に応じてサイズを何度でも拡張できる。ただ縮小はできないので、縮小したい場合は新しく作成し、既存のものを削除しなければならない  


ボリュームタイプの変更は4つの現行世代タイプ間でのタイプ変更が可能  

### セキュリティ  
ストレージ自体を暗号化するオプションがあり、有効化するとボリュームが暗号化されるだけでなく、暗号化されたボリュームから取得したスナップショットも暗号化される  
EBS官をまたぐデータ通信時のデータも暗号化された状態となる。  

### マルチアタッチ  
制約が多いものの複数のインスタンスからの同一のEBSをアタッチできる機能。同一AZ内でのみ可能。またプロビジョンドIOPSボリュームのみ可能。  

### Amazon Data Lifecycle Manager  
EBSのスナップショットの作成や削除をスケジューリングすることができる。DLMを利用することで次のようなことが可能となる  
- EBSの定期的なバックアップスケジュールを実施して貴重なデータを保護する  
- 監査担当者または社内のコンプライアンスが必要とするバックアップを保持する  
- 古いバックアップを削除してストレージコストを削減する  
  
  


## Amazon Elastic File System(EFS)  
容量無制限で複数のEC2インスタンスから同時にアクセスできる。クライアントからEFSへの接続はNFSプロトコルをサポートしているため、NFSクライアントさえあれば特別なツールや設定はいらない。  

amazon-efs-utilsツールを使うと、EFSへのマウントに関する推奨オプションが含まれていたり、ファイルシステムにトラブルが発生した場合のトラブルシューティングに役立つログが記録できたりするためEFSへ接続するクライアントには導入が進められる。  

以下の３つの要素から構成されている。
- ファイルシステム  
- マウントターゲット  
- セキュリティグループ  

ファイルが作成されると３か所以上のAZに自動的に保存される分散ファイルシステムを構成する。AZごとにサブネットマスクを指定してマウントターゲットを作成する。作成すると、ターゲットポイントが1つと各AZのマウントターゲット用IPアドレスが発行される。またマウントターゲットにはセキュリティグループを指定でき、EC2からEFSへの通信要件を定義して不要なアクセスを制限できる。  

### EFSのパフォーマンスモード  
汎用パフォーマンスモードと最大I/Oパフォーマンスモードがあるが、ほとんどの場合は汎用パフォーマンスモードを使う。同時に数百から数千台といったクライアントから同時にアクセスある場合は最大I/Oパフォーマンスモードを使う。  
どちらのモードを選択するのがよいかを見分ける指標としてCloudWatchのPercentIOLimitというメトリクスが参考になる。  

### スループットモード  
2つのスループットモードが存在する  
- バーストスループットモード  
このモードにはＥＦＳに保存されているデータ容量に応じてベースラインとなるスループットが設定されている。一時的なスループットの上昇にも耐えられるようなバースト機能を持ったモード。  
  
- プロビジョニングスループットモード  
バーストスループットモードで設定されているベースラインスループットを大幅に上回るスループットが必要な場合や、一時的なバースト時にバーストスループットで定められている最大スループットよりも高い性能が必要な場合に、任意のスループット値を指定できるモード。  

CloudWatchのBurstCreditBalanceというメトリクスが参考になる。  




## FSx  
フルマネージドなファイルストレージサービス。Windows向けでビジネスアプリケーションなどで利用されるAmazonFSx for Windowsファイルサーバーとハイパフォーマンスコンピューティング向けのAmazon FSx for Lustreの2種類がある。  

### Amazon FSx for Windowsファイルサーバー  
Windows用のサービスでフルマネージドなWindowsのファイルサーバーとして使える。Windows Server上に構築されるので、Windowsで利用できるユーザークォータ、エンドユーザーファイルの復元、AD統合などの幅広い機能が利用可能。単一のサブネットにエンドポイントとなるENI(Elastic Network Interface)を配置し、そのエンドポイントにはSMBプロトコルを介してアクセス可能、ENIにはセキュリティグループを設定することもできる。  

### Amazon FSx for Lustre  
フルマネージドな分散ファイルシステムでS3とシームレスに統合できる。Lustreはファイルシステム作成時にS3バケットと関連付けをする。S3条のファイルをインデックスし、あたかも自前のファイルのように見せる。2回目以降はキャッシュを利用するので高速。  

