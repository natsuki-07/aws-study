# AWS Auto Scaling  
安定した予測可能なパフォーマンスを可能な限り低コストで維持するためにアプリケーションをモニタリングし、容量を自動で調整する。複数のサービスにまたがる複数のリソースのためのアプリケーションスケーリングを数分で簡単に設定できる。  
マネジメントコンソール、CLI、SDKを使用して簡単に使用を開始でき、追加料金はかからない  
   
# Amazon EC2 AutoScaling  
アプリケーションの可用性を維持するうえで役立ち、定義した条件に応じて EC2 インスタンスを自動的に追加または削除できる。また異常なインスタンスを検出して削除し、新しいインスタンスに置き換えることもできる。追加料金はかからない
  
EC2 Auto Scalingグループ(ASG)は類似する特性を共有するEC2インスタンスの集合のこと。  
EC2 Auto Scaling グループを作成する場合は、起動設定を指定する必要がある。またELBのターゲットグループに対してスケーリングを構成することが必要  

複数のサービスにまたがる複数のリソースのスケーリングを管理する場合は、AWS Auto Scaling を使用。スケーリング対象が Amazon EC2 Auto Scaling グループのみの場合や、目的が EC2 フリートの正常性の維持のみの場合は、EC2 Auto Scaling を使用  

## スケーリングポリシー
Auto Scalingのスケーリング方法は3つに分類できる。  
- 動的なスケーリング  
- 予測スケーリング  
- スケジュールスケーリング  
頻繁に利用される動的なスケーリングにはさらに３つのスケーリングポリシーがある。  
- 簡易スケーリング  
- ステップスケーリング  
- ターゲット追跡スケーリング  

- 簡易スケーリング・・・CPU使用率が70%を超えたらといったように1つのメトリクスに対して1つの閾値を設定する  

- ステップスケーリング・・・1恒元陸巣に対して複数の閾値を設定する。簡易スケーリングの上位互換

- ターゲット追跡スケーリング・・・1つのメトリクスに対して目標値を設定する。CPUの利用率を50%にと目標値を設定すると50％を維持できるように調整されるようになる。  

## スケールアウトの猶予期間  
インスタンスの起動には時間がかかり、ぞの缶にエラーが出続けると想定しないスケーリング動作になってしまう可能性があるので一定期間ヘルスチェックをしないという猶予期間がある。画面コンソールから作った場合はデフォルトでは300秒だが、CLIやSDKから作ると0秒。  

猶予期間以外にもウォームアップとクールダウンというパラメータがある。クルーダウンは正式にはスケーリングクールダウンという。これはAuto Scalingが発動したちょくどに追加でインスタンスの増減がなされるのを防ぐための設定。  
ウォームアップはおおむねステップスケーリングにおいて差分でインスタンスを追加するために追加された機能。ウォームアップ中はそのさらーむでのインスタンスの追加はされない。またウォームアップ中に次のアラートが発動した場合は差分の台数が追加される。  

## その他のオプション  
### ライフサイクルフック  
Auto Scalingグループによるインスタンスの起動時または削除時にインスタンスを一時停止してカスタムアクションを実行する機能。たとえば、起動時にデータを取得してきたり削除時にログやデータの退避の処理を追加するといった用途で使える。  

### 終了ポリシー  
スケールインの際にどのインスタンスを削除するのかを決めるのが終了ポリシー。デフォルトでは最も古い起動設定のインスタンスから削除する。NewesInstanceを設定すると新しいのから削除する。

|  終了ポリシー  |  動作  |
|  ----  |  ----  |
|  OldestInstance  |  最も古いインスタンスを削除  |
|  Newestinstance  |  最も新しいインスタンスを削除  |
|  OldestLaunchConfiguration  |  最も古い起動設定のインスタンスを削除  |
|  ClosestToNextInstanceHour  |  次の課金時間に最も近いインスタンスを削除  |
|  Default  |  ＡＺ間の台数の均衡を保つようにインスタンスを削除  |
|  OldestLaunchTemplate  |  最も古い起動テンプレートを使用するインスタンスを削除  |
|  AllocationStorategy  |  スポットまたはオンデマンドなどのインスタンスタイプの配分戦力に沿って削除  |  

## 設計ポイント  
1. サーバーをステートレスに、つまり状態を保持しないように設計する  
2. AZをまたがってインスタンスを配置する設計にする  