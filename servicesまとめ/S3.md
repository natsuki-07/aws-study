# Amazon Simple Storage Service(S3)  
スケーラビリティ、データ可用性、セキュリティ、およびパフォーマンスを提供するオブジェクトストレージサービス。S3は99.999999999%(9×11)の耐久性を実現するように設計されていて何百万ものアプリケーションのデータを保存している。  

ストレージリソースをスケールアップ/ダウンして変動する需要に対応する。　　
  
S3の構成要素は
1. バケット・・・オブジェクトを保持するための領域。  
2. オブジェクト・・・S3に格納されるデータそのもの  
3. メタデータ・・・

S3バージョニングを使用するとS3に保存したオブジェクトのすべてのバージョンの保存、取り出し、復元を簡単にできる。これにより意図的なユーザーアクションやアプリケーション障害が発生しても復元することができる。

## レプリケーション  
リージョン間をまたぐクロスリージョンレプリケーションにより耐障害性を高める。  

S3レプリケーションを使用すると1つ以上の送信先バケットに対してオブジェクトを同一または異なるAWSリージョンにレプリケートして、レイテンシー、コンプライアンス、セキュリティ、災害復旧などのユースケースを削減できる。S3クロスリージョンレプリケーションはソースS3バケットから異なるAWSリージョンの1つ以上の送信先バケットにレプリケートするように設定できる。  
データ転送費用が発生する  


## 整合性モデル  
S3は高い可用性を実現するため、データ更新・削除には結果整合性モデルを採用。そのため、データの保存後、複製が完全に終わるまでの間にデータを参照すると、参照先によっては保存前の状態が表示されることもあるので注意が必要。    
同時書き込みはタイムスタンプ処理を実施。  


## データ解析
- S3 Select・・・S3の内部機能として有している検索機能でS3内で直接クエリを実行し、データを取得できる。

- Amazon Athena・・・Selectと同じくクエリを使うが、より高度で複雑なこともできる。

- Amazon Macie・・・機密データ検出や調査に使う。  

- Amazon Redshift Spectrum・・・S3の格納データに対して、Redshiftから直接クエリを実行できる機能  
  
## ストレージクラス
アクセスレベルによってさまざまなレートを適用できるS3ストレージクラスにデータを保存することでコスト効率を図れる  
  
- S3標準  
アクセス頻度の高いデータ向けに高い耐久性、可用性、パフォーマンスのオブジェクトストレージを提供する。ミリ秒単位のアクセス時間を必要とする、パフォーマンスが要求されるユースケース、およびアクセス頻度が最も高いデータ向けに設計されている。高いスループットと低レイテンシーパフォーマンスを必要とするユースケースに適していて、クラウドアプリケーション、動的なウェブサイト、コンテンツ配信、モバイルやゲームのアプリケーション、ビッグデータ分析など幅広いユースケースに最適。  

- S3 Inteligent-Tiering  
アクセスパターンが変化したときに4つのアクセス階層間でオブジェクトを移動することで自動的のコストを削減する唯一のクラウドストレージクラス。オペレーション上のオーバーヘッドを発生させることなく、最もコスト効率の高いアクセス階層に自動的にデータを移動することで、コストを最小限に抑えるように設計されている。  

- S3標準- 低頻度アクセス(S3標準 - IA)  
アクセス頻度は少ないが必要に応じてすぐに取り出すことが必要なデータに適している。S3標準 - IAはS3標準と同じ高い耐久性、高スループット、低レイテンシーを低価格のストレージ料金および取り出し料金で提供する。30日間以上保存予定の128KB以上のオブジェクトに最適。  

- Amazon S3 1ゾーン - 低頻度アクセス(S3 1 ゾーン - IA)  
S3 1ゾーン- IAはアクセス頻度は低いが必要に応じてするに取り出すことが必要なデータに適している。データを少なくとも3つのAZに保存するほかのS3ストレージクラスとは異なりS31ゾーン - IAは一つのAZにデータを保存するためコストを削減できる。オンプレミスのデータのセカンダリバックアップのコピー、簡単に作成できるデータ、S3クロスリージョンレプリケーションを使用して別のAWSリージョンですでにレプリケートしたストレージを、コンプライアンスまたは災害対策目的で保存する場合に最適。  

- Amazon S3 Glacier  
セキュアで耐久性が高い、低コストのストレージクラスでデータのアーカイブに適している。データの量にかかわらず低コストでデータを保存できる。数分から数時間まで、3 種類の取り出しオプションを用意している。アップロードから3か月未満でアーカイブが削除された場合早期削除料金が発生する。アーカイブを保存するためのコンテナとしてボールとを使用する。  

- Amazon S3 Glacier Deep Archive  
最も低コストのストレージクラスであり1年のうちに1回か2回しかアクセスされないようなデータを対象とした長期保存やデジタル保存をサポートする。取り出し時間は 12 時間以内

- S3 on Outposts  
オンプレミスのAWS Outposts環境でのオブジェクトストレージが提供される。AWS の各リージョンで提供が開始された S3 の 機能や API により、S3 on Outposts を使用する Outpost でのデータの保存と取得が容易になる。S3 Outposts のストレージクラスは、ローカルでのデータレジデンシーの要件があるワークロードを処理するのに最適  
  
### S3 Glacier  
4つの要素から構成される。  
- ボールド・・・アーカイブを保存するための領域。S3のバケットに相当する。ホールド名はリージョン及びアカウント内で一意
  
- アーカイブ・・・S3 Glacierに格納されるデータ自身。S3のオブジェクトに相当する。アーカイブIDは自動的に付与され利用者が指定できない  
  
- インベントリ・・・各ボールドに保存されているアーカイブの情報を収集する。およそ1日1回の頻度で更新されるため、最新情報が反映されるまでにはタイムラグがある。リアルタイムで状況を確認したい場合は、マネジメントコンソールで確認するか、ListVaultsAPIを実行する  
  
- ジョブ・・・アーカイブやインベントリに対して検索をかけたり、データをダウンロードするといった要求に対して処理を実行し、処理の状況を管理する。  

アーカイブしたデータを閲覧するには、データの取り出しリクエストを出す。待ち時間に応じて高速、標準、バルクの3種類があり短いほど費用が高くなる。  
  
データを保存するときにSSLを使ったデータの転送が行われる。保存されるデータは標準で暗号化が行われる。  

#### 削除禁止機能（ボールとロック)  
S3 Glacier APIを通じてボールとロックポリシーを対象となるボールトに要求することから始まる。ポリシーがボールトとと関連付けられるとボールトロックがInProgressの状態になりロックIDが返される。ユーザーがこのロックIDを使ってボールトロックの開始を要求するとロック状態が完了し、この後変更削除ができなくなる。  
    

#### S3 Glacier Select  
アーカイブデータに対してSQLを実行して、条件に合ったデータを抽出する機能。  



## 暗号化  
- SSE-S3 標準暗号化方式で簡易に利用可能。暗号化キーの作成・管理をS3側で自動で実施する。  
- SSE-KMS KMSに設定した暗号化キーを利用した暗号化を実施。ユーザー側でKMSを利用して暗号化キーを作成・管理することが可能でクライアント独自の暗号キーを利用できる  
- SSE-C ユーザーが指定したキーによるサーバー側の暗号化を使用することが可能。利用設定や管理が煩雑になるのがデメリット  
- クライアントサイド暗号化(CSE) クライアント側の暗号化ではS3に送信する前にデータを暗号化する方式。KMSなどを利用して暗号化キーを作成・実施。アプリケーション内に保存したマスターキーを使用  
  
## アクセスアナライザー  
アクセスポリシーに沿っているかを確認し、不正なアクセスが発生していないか、アクセスポリシーを監視する機能。IAMアクセスアナライザーに連動したS3向けの機能  
どのバケットがどのようなことができるのかがわかる。アクセス状況をモニタリングする。  
  
## S3 Transfer Acceleration  
クライアントとS3バケットの間で、長距離にわたるファイル転送を高速、簡単、安全に実行。CloudFrontのエッジローケーションを活用し、ユーザーは最寄りのエッジロケーションに転送し、あとはAWSの太陽量かつ安定したバックボーン回線を利用して転送することができる  


## ライフサイクル管理  
バケット内のオブジェクト単位でストレージクラスの変更や削除時期などを設定することで実行を自動化する。  
- 移行アクション・・・データの利用頻度に応じてストレージクラスを変更するアクション。オブジェクト作成当初はアクセス頻度が高いが、一定期間経過すると利用頻度や重要度が低くなり、最後にはアーカイブとして保存しておくといったライフサイクルに応じて最適なストレージクラスへ移行することができる    
  
- 有効期限アクション・・・指定された期限を超えたオブジェクトをS3から削除するアクション。利用期間が決まっているオブジェクトや一時的に作成されたオブジェクトなどを定期的に整理することができる。
  
## マルチパートアップロード  
大容量オブジェクトをいくつかに分けてアップロードする機能
  
## バッチオペレーション  
S3オブジェクトの大量データに対して一括処理を実行することが可能  

  
## S3のアクセス管理  
バケットポリシー、ACL、IAMが使える。  
バケットポリシーはバケット単位でアクセスを制御する。そのバケットに保存されるオブジェクトすべてに適用されるのでバケットの用途に応じた全体的なアクセス制御をするときに有効。ACLはオブジェクト単位で公開/非公開を制御する場合に使用する。IAMではユーザー単位でS3のリソースを制御する場合に使用する。  

署名付きURLはアクセスを許可したいオブジェクトに対して期限を指定してURLを発行する機能。バケットやオブジェクトのアクセス制御を変更することなく特定のオブジェクトに一時的にアクセスを許可したい場合に非常に有効。署名付きURLを知っていればだれでもアクセスできる。
  
## S3とオンプレミス
AWS Storage Gatewayを使用すればオンプレミスアプリケーションをシームレスに接続してAWS Storageに拡張すると同時にデータをローカルにキャッシュして低レイテンシーでアクセスできる。  
  
- ファイルゲートウェイ・・・S3オブジェクトにStorage Gatewayを経由してファイルデータを格納  
  
- ボリュームゲートウェイ・・・S3およびEBS snapshotsをバックエンドとしたブロックストレージ。データ保存領域全体を1つのボリュームとして管理する。
 - キャッシュ型ボリューム・・・頻繁に利用するデータはStorage Gateway内のキャッシュディスクに保存して高速にアクセスすることを可能とし、すべてのデータを保存するストレージとしてS3を利用するタイプのボリュームゲートウェイ。キャッシュボリュームへのアクセスでは頻繁に使用するデータに対して高速にアクセスでき、アップロードバッファボリュームはS3にアップロードするデータを一時的に保管するためのもの  
 - 保管型ボリューム・・・全てのデータを保存するストレージとしてローカルストレージを利用し、データを定期的にスナップショット形式でS3へ転送するタイプのボリュームゲートウェイ。  
  
- テープゲートウェイ・・・S3とGlacierにデータを保管する仮想テープストレージとVTL管理。  
  
AWS PrivateLinkを使用してS3とオンプレミスの間にプライベート接続をセットアップする。  
  
AWS DataSyncを使用することでオンプレミスストレージとS3の間でデータ転送を自動化することもできる。  
  
  
### Storage Gatewayのセキュリティ  
- CHAP要素・・・クライアントからStorage GatewayにiSCSIで接続する際に、CHAP認証を設定することができる。不正アクセスや通信の盗聴などのリスクを軽減できる  

- データ暗号化・・・Storage GatewayではKMSを使ってデータの暗号化が可能。暗号化されるタイミングはデータが保管されるときであるため、S3に保存されるタイミングで暗号化される、  

- 通信の暗号化・・・・オンプレミス環境からtorage Gatewayを経由してS3にデータを転送する際にはHTTPSが使用されるため、通信時のデータ内容は暗号化される。  

## 料金  
コスト要素は6つあり、ストレージ料金、リクエストとデータ取り出し料金、データ転送と転送高速化の料金、データ管理機能および分析機能の料金、およびS3 Object Lamdaでのデータを処理するための料金  

S3バケットにオブジェクトを保存するための料金。課される料金は、オブジェクトのサイズ、当月中にオブジェクトを保管した期間の長さ、ストレージクラスで異なる。


## 用途  
- コンテンツ配信・保管・・・CMSから画像などのコンテンツデータの保存先に利用  

- ログ・バッチの保管場所・・・ログファイルやバッチファイルの保存場所として利用する  

- バックアップ/ディザスタリカバリ・・・バックアップの中期の保存場所として利用  

- WEBの静的ホスティング・・・S3のみで静的なWEBサイトをホスティングして構築可能  

- データレイク・・・データレイクとしてデータ活用のハブとして利用   


## snowball  
物理ストレージデバイスを使用し、インターネットを迂回してAWSとの大容量データ転送を高速化するサービス。オンプレミスのデータストレージロケーションとS3との間でデータのインポートおよびエクスポートができる。  
すべてのリージョンで80TBモデルを使用可能, 暗号化が強制  
